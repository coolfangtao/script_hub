import streamlit as st
import re
import os
from typing import List, Dict, Tuple
import tempfile
from datetime import datetime

def extract_metadata(text: str) -> Tuple[str, str, str, str]:
    """
    从文本中提取元数据：书名、作者、笔记总数和清理后的文本

    参数:
        text: 原始笔记文本

    返回:
        tuple: (书名, 作者, 笔记总数, 清理后的文本)
    """
    lines = text.split('\n')

    # 提取书名（第一行）
    book_name = lines[0].strip() if lines else ""

    # 提取作者（书名后的第一个非空行）
    author = ""
    for i in range(1, min(5, len(lines))):  # 在前5行内查找作者
        if lines[i].strip():
            author = lines[i].strip()
            break

    # 提取笔记总数（作者后的第一个非空行）
    note_count = ""
    for i in range(2, min(6, len(lines))):  # 在前6行内查找笔记数
        if lines[i].strip() and lines[i] != author:
            note_count = lines[i].strip()
            break

    # 去除末尾的固定标识
    cleaned_text = re.sub(r'--\s*来自微信读书\s*$', '', text, flags=re.MULTILINE)

    return book_name, author, note_count, cleaned_text

text = """《如何阅读一本书》

莫提默·艾德勒 查尔斯·范多伦
104个笔记

第一篇 阅读的层次

◆ 2025/09/23发表想法

G 好问题，思考一下自己在做某些事情例如刷视频，打游戏的时候是否真的增加了自己对这个世界的了解？

原文：到底这些新时代的传播媒体是否真能增进我们对自己世界的了解？

◆ 到底这些新时代的传播媒体是否真能增进我们对自己世界的了解？

◆ 2025/09/23发表想法

G 很好的观点：现代咨询只是让你know，但并不understand

原文：太多的资讯就如同太少的资讯一样，都是一种对理解力的阻碍。换句话说，现代的媒体正以压倒性的泛滥资讯阻碍了我们的理解力。

◆ 太多的资讯就如同太少的资讯一样，都是一种对理解力的阻碍。换句话说，现代的媒体正以压倒性的泛滥资讯阻碍了我们的理解力。

◆ 2025/09/23发表想法

G 阅读要主动，要深入思考，做任何事情都是这样

原文：第一提醒读者，阅读可以是一件多少主动的事。第二要指出的是，阅读越主动，效果越好。

◆ 第一提醒读者，阅读可以是一件多少主动的事。第二要指出的是，阅读越主动，效果越好。

◆ 2025/09/23发表想法

掌握对每种信息的掌握技巧

原文：我们可以把这个类比的概念往前推。捕手的艺术就在能接住任何球的技巧——快速球、曲线球、变化球、慢速球等等。同样地，阅读的艺术也在尽可能掌握住每一种讯息的技巧。

◆ 我们可以把这个类比的概念往前推。捕手的艺术就在能接住任何球的技巧——快速球、曲线球、变化球、慢速球等等。同样地，阅读的艺术也在尽可能掌握住每一种讯息的技巧。

◆ 读者想“接住”多少意念完全看他在阅读时多么主动，以及他投入不同心思来阅读的技巧如何。

◆ 拿同样的书给不同的人阅读，一个人却读得比另一个人好这件事，首先在于这人的阅读更主动，其次，在于他在阅读中的每一种活动都参与了更多的技巧。

◆ 2025/09/23发表想法

在混乱中创造秩序

原文：只有一种方式是真正地在阅读。没有任何外力的帮助，你就是要读这本书。你什么都没有，只凭着内心的力量，玩味着眼前的字句，慢慢地提升自己，从只有模糊的概念到更清楚地理解为止。

◆ 只有一种方式是真正地在阅读。没有任何外力的帮助，你就是要读这本书。你什么都没有，只凭着内心的力量，玩味着眼前的字句，慢慢地提升自己，从只有模糊的概念到更清楚地理解为止。

◆ 这种阅读就是让一本书向你既有的理解力做挑战。

◆ 这是一个凭借着头脑运作，除了玩味读物中的一些字句之外，不假任何外助，以一己之力来提升自我的过程。

◆ 为获得资讯而阅读，与为增进理解而阅读，其间的差异不能以道里计。

◆ 2025/09/23发表想法

G 很好的做法，以后向别人输出的时候也要这么做，要增强别人的理解能力，而不是灌输资讯

原文：这里的“学习”指的是理解更多的事情，而不是记住更多的资讯——和你已经知道的资讯在同一水平的资讯。

◆ 这里的“学习”指的是理解更多的事情，而不是记住更多的资讯——和你已经知道的资讯在同一水平的资讯。

◆ 简单来说，我们只能从比我们“更高杆”的人身上学习。我们一定要知道他们是谁，如何跟他们学习。有这种想法的人，就是能认知阅读艺术的人，就是我们这本书主要关心的对象。

◆ 事实上，任何一本书能增进理解或增加资讯时，也就同时有了消遣的效果。

◆ 阅读就是学习：指导型的学习，以及自我发现型的学习之间的差异

◆ 所谓吸收资讯，就只是知道某件事发生了。想要被启发，就是要去理解，搞清楚这到底是怎么回事：为什么会发生，与其他的事实有什么关联，有什么类似的情况，同类的差异在哪里等等。

◆ 2025/09/23发表想法

知其然，知其所以然

原文：要能被启发，除了知道作者所说的话之外，还要明白他的意思，懂得他为什么会这么说。

◆ 蒙田说：“初学者的无知在于未学，而学者的无知在于学后。”

◆ 自我发现的学习是必要的——这是经由研究、调查或在无人指导的状况下，自己深思熟虑的一种学习过程。

◆ 2025/09/23发表想法

举一反三

原文：如果“思考”是指运用我们的头脑去增加知识或理解力，如果说自我发现型的学习与指导型的学习是增加知识的惟二法门时，那么思考一定是在这两种学习当中都会出现的东西。

◆ 思考只是主动阅读的一部分。一个人还必须运用他的感觉与想象力。一个人必须观察，记忆，在看不到的地方运用想象力。

◆ 2025/09/23发表想法

要在阅读的过程中主动发现

原文：阅读也就是一种发现——虽然那是经过帮助，而不是未经帮助的一个过程。

◆ 阅读也就是一种发现——虽然那是经过帮助，而不是未经帮助的一个过程。

◆ 如果你问一本书一个问题，你就必须自己回答这个问题。在这样的情况下，这本书就跟自然或世界一样。当你提出问题时，只有等你自己作了思考与分析之后，才会在书本上找到答案。


第二章 阅读的层次

◆ 一位读者要追求的目标——为了消遣，获得资讯或增进理解力——会决定他阅读的方式。

◆ 一个分析型的阅读者一定会对自己所读的东西提出许多有系统的问题。

◆ 在这个层次的阅读中，读者会紧抓住一本书——这个比喻蛮恰当的——一直要读到这本书成为他自己为止。

◆ 在做主题阅读时，阅读者会读很多书，而不是一本书，并列举出这些书之间相关之处，提出一个所有的书都谈到的主题。


第三章 阅读的第一个层次：基础阅读

◆ 从一本书所提出来的一个观点转化到另一个观点，在同一个主题上，对不同的作者所提出来的观点作比较。这是阅读的成熟阶段，应该是一个青少年就该达到的境界，也是终其一生都该持续下去的。

◆ 。大学的文凭应该代表着一般大学毕业生的阅读水平，不但能够阅读任何一种普通的资料，还能针对任何一种主题做个人的研究

◆ 然而，通常大学生要在毕业以后，再读三四年的时间才能达到这样的程度，并且还不见得一定达到。

◆ 2025/09/23发表想法

不要给自己设限！

原文：我们的历史一直强调，无限制的受教育机会是一个社会能提供给人民最有价值的服务——或说得正确一点，只有当一个人的自我期许，能力与需要受限制时，教育机会才会受到限制。

◆ 我们的历史一直强调，无限制的受教育机会是一个社会能提供给人民最有价值的服务——或说得正确一点，只有当一个人的自我期许，能力与需要受限制时，教育机会才会受到限制。


第四章 阅读的第二个层次：检视阅读

◆ （我们会在第二部谈到词汇的重要问题。暂时你必须先依靠自己的常识，根据前面所提的第一及第二步骤，判别出一本书里你认为重要的词汇。）你所阅读的段落很可能就是个要点——这本书的关键点——或是关系到作者意图与态度的新方法。

就跟目录页一样，现在你可能要检查一下本书的索引。你会辨认出一些我们已经讨论过的重要词目。那你能不能再找出其他一些也很重要的词目呢？——譬如说，参考一下词目底下所列被引用页数的多寡？

(4)如果那是本包着书衣的新书，不妨读一下出版者的介绍。许多人对广告文案的印象无非是些吹牛夸张的文字。但这往往失之偏颇，尤其是一些论说性的作品更是如此，大致来说，许多书的宣传文案都是作者在出版公司企宣部门的协助下亲自写就的。这些作者尽力将书中的主旨正确地摘要出来，已经不是稀奇的事了。

◆ 2025/09/23发表想法

花点时间想一下，将来这本书的内容可以用来干嘛

原文：你也应该比以前更清楚，在脑海中这本书该归类为哪一个种类，以便将来有需要时好作参考。

◆ 你也应该比以前更清楚，在脑海中这本书该归类为哪一个种类，以便将来有需要时好作参考。

◆ 你可以把自己想成是一个侦探，在找寻一本书的主题或思想的线索。随时保持敏感，就很容易让一切状况清楚。

◆ 2025/09/23发表想法

不敢苟同，我读百年孤独的时候，人名甚是混乱，实在读不下去了，就自己做了个族谱，后面再读就豁然开朗了。所以难读的得先搞清楚难读在哪里，是人名或者新概念太多，还是什么其他原因

原文：头一次面对一本难读的书的时候，从头到尾先读完一遍，碰到不懂的地方不要停下来查询或思索。

◆ 更糟的是，这些不熟练的阅读者在每看过两三行之后，眼睛就自然地“倒退”(regress)到原点——也就是说，他们又会倒退到先前读过的句子与那一行去了。

◆ 将大拇指与食指、中指合并在一起，用这个“指针”顺着一行一行的字移动下去，速度要比你眼睛感觉的还要快一点。强迫自己的眼睛跟着手部的动作移动。

◆ 在阅读一本书的时候，慢不该慢到不值得，快不该快到有损于满足与理解。


第五章 如何做一个自我要求的读者

◆ 他们有没有真正在阅读手中的那本书，造成了其间的差异，而且是极大的差异。

◆ 如果你的阅读目标是获得利益——不论是心灵或精神上的成长——你就得保持清醒。这也意味着在阅读时要尽可能地保持主动，同时还要做一番努力——而这番努力是会有回馈的。

◆ 你在阅读时要提出问题来—在阅读的过程中，你自己必须尝试去回答的问题。

◆ 2025/10/02发表想法

what: 讲了什么？
how: 怎么讲的？
why: 为什么对？为什么不对？
todo: 能对你的行动有什么影响？

原文：如果这本书不只提供了资讯，还启发了你，就更有必要找出其他相关的、更深的含意或建议，以获得更多的启示。

◆ 如果这本书不只提供了资讯，还启发了你，就更有必要找出其他相关的、更深的含意或建议，以获得更多的启示。

◆ 任何一种超越基础阅读的阅读层次，核心就在你要努力提出问题（然后尽你可能地找出答案）。这是绝不可或忘的原则。

◆ 2025/10/02发表想法

主动的发现问题并寻找答案，并精确的描述这种答案

原文：光是知道这四个问题还不够。在阅读过程中，你要记得去提出这些问题。要养成这样的习惯，才能成为一个有自我要求的阅读者。除此之外，你还要知道如何精准、正确地回答问题。如此训练而来的能力，就是阅读的艺术。

◆ 光是知道这四个问题还不够。在阅读过程中，你要记得去提出这些问题。要养成这样的习惯，才能成为一个有自我要求的阅读者。除此之外，你还要知道如何精准、正确地回答问题。如此训练而来的能力，就是阅读的艺术。

◆ 俗话说：“你必须读出言外之意，才会有更大的收获。”而所谓阅读的规则，就是用一种比较正式的说法来说明这件事而已。此外，我们也鼓励你“写出言外之意”。不这么做，就难以达到最有效的阅读的境界。

◆ 2025/10/02发表想法

要让书成为自己的一部分，而不是读完就忘

原文：要真正完全拥有一本书，必须把这本书变成你自己的一部分才行，而要让你成为书的一部分最好的方法——书成为你的一部分和你成为书的一部分是同一件事——就是要去写下来。

◆ 要真正完全拥有一本书，必须把这本书变成你自己的一部分才行，而要让你成为书的一部分最好的方法——书成为你的一部分和你成为书的一部分是同一件事——就是要去写下来。

◆ 阅读一本书应该像是你与作者之间的对话。

◆ 你读完一本书，在最后的空白页写下个人的索引后，再翻回前面的空白页，试着将全书的大纲写出来

◆ 在这里要注意的是，这些笔记主要的重点是全书的架构，而不是内容——至少不是细节。因此我们称这样的笔记为结构笔记(structural note-making)。

◆ 从实际去做中学习到如何去做的道理。

◆ 2025/10/02发表想法

习惯是第二天性

原文：这也是为什么说习惯是第二天性的道理。

◆ 这也是为什么说习惯是第二天性的道理。

◆ 人们会指着一个具有高度原创性的画作或雕塑说：“他不按规矩来。他的作品原创性非常高，这是前人从没有做过的东西，根本没有规矩可循。”其实这些人是没有看出这个艺术家所遵循的规则而已。

◆ 为了要忘掉这些单一的动作，一开始你必须先分别学会每一个单一的动作。

◆ 但是阅读就跟滑雪一样，除非你对每一个步骤都很熟练之后，你才能将所有不同的步骤连结起来，变成一个复杂却和谐的动作。

◆ 一个人只要学习过一种复杂的技巧，就会知道要学习一项新技巧，一开始的复杂过程是不足为惧的。

◆ 当所有相关动作都能相当自然地做出来时，你就已经养成做这件事的习惯了。


第二篇 阅读的第三个层次：分析阅读

◆ 规则一，你一定要知道自己在读的是哪一类书，而且要越早知道越好。最好早在你开始阅读之前就先知道。

◆ 只有当你在不同的书籍之间能找出区别，并且定出一些合理又经得起时间考验的分类时，这个规则才会更简单明白一些。

◆ 要让知识变成实用，就要有操作的规则。我们一定要超越“知道这是怎么回事”，进而明白“如果我们想做些什么，应该怎么利用它”。

◆ 首先，你要学习去怀疑一切。

◆ 2025/10/03发表想法

科学研究的是物理世界的规律，哲学研究的是精神世界的规律和答案，但往往科学试图以科学的方法去探究人的精神世界（例如心理学），哲学也努力去得到一个囊括物理和精神世界的大一统理论，因而科学和哲学的研究领域出现交叉

原文：哲学比较像科学，不像历史，追求的是一般的真理，而非发生在过去的特定事件，不管那个过去是近代或较远的年代。但是哲学家所提出的问题跟科学家又不一样，解决问题的方法也不相同。

◆ 如果一本理论的书所强调的内容，超乎你日常、例行、正常生活的经验，那就是科学的书。否则就是一本哲学的书。


第七章 透视一本书

◆ 2025/10/03发表想法

去看待一件事物时，要有一双x光一样的眼睛，去看清事物的骨架

原文：但是你一定要用一双X光般的透视眼来看这本书，因为那是你了解一本书，掌握其骨架的基础。

◆ 但是你一定要用一双X光般的透视眼来看这本书，因为那是你了解一本书，掌握其骨架的基础。

◆ 分析阅读的第二个规则是：使用一个单一的句子，或最多几句话（一小段文字）来叙述整本书的内容。

◆ 你必须能用几句话，告诉你自己，或别人，这整本书在说的是什么。

◆ 第三个规则可以说成是：将书中重要篇章列举出来，说明它们如何按照顺序组成一个整体的架构。

◆ 如果组成的各个部分之间没有有机的关联，一定不会形成一个整体。说得严格一点，根本不会有整体，只是一个集合体而已。

◆ 本书显示出人类没有与生俱来的观念，人类所有的知识都是由经验而来的。

◆ 一本书的整体精神可以有各种不同的诠释，没有哪一种一定对。

◆ 2025/10/04发表想法

以后读书时，读完一章或者一小节要回头看看

原文：我们建议你自己动手，用你的观点将宪法区分为几个主要的部分，列出大纲。

◆ 作者拟定了纲要，以写出一本好书。而你则要拟定你的纲要，才能读得明白。

◆ 如果他是个好作者，就不会将一个发育不良的骨架埋藏在一堆肥肉里，同样的，也不会瘦得皮包骨，让人一眼就看穿。如果血肉匀称，也没有松弛的赘肉，那就可以看到关节，可以从身体各个部位的活动中看出其中透露的言语。

◆ 所谓文章的清楚明白，就是跟纲要的区隔是否清楚有关，所谓文章的前后一贯，就是能把不同的重点条理有序地排列出来。

◆ 与其他类似事件，或不相同事件的关联是什么？这件事是如何进行的？以上这些都是理论性的问题。有哪些结果可以选择？应该采取什么样的手段才能获得某种结果？要达到某个目的，应该采取哪些行动？以什么顺序？在这些条件下，什么事是对的，或怎样才会更好，而不是更糟？在什么样的条件下，这样做会比那样做好一些？以上这些都是实用的问题。

这些问题还不够详尽，但是不论阅读理论性还是实用性的书，这些都是经常会出现的典型问题。这会帮助你发现一本书想要解决的问题。在阅读富有想象力的文学作品时，这些问题要稍作调整，但还是非常有用。

分析阅读的第一个阶段

我们已经说明也解释了阅读的前四个规则。这些是分析阅读的规则。如果在运用之前能先做好检视阅读，会更能帮助你运用这些规则。


◆ 2025/10/07发表想法

就像用人一样：
1. 这大致是哪类人？
2. 这是个什么样的人？（用简短的语言描述出来）
3. 提取这个人的核心特征（找到这些特征的骨架）
4. 这个人可以用在哪里？

原文：当你运用这四个规则来阅读一本书，或任何又长又难读的书时，你就完成了分析阅读的第一个阶段。

◆ 分析阅读的第一阶段，或，找出一本书在谈些什么的四个规则：(1)依照书本的种类与主题作分类。(2)用最简短的句子说出整本书在谈些什么。(3)按照顺序与关系，列出全书的重要部分。将全书的纲要拟出来之后，再将各个部分的纲要也一一列出。(4)找出作者在问的问题，或作者想要解决的问题。


第八章 与作者找出共通的词义

◆ 2025/10/07发表想法

只有共享成功的沟通才算真的沟通，要努力让沟通成功

原文：而沟通是一个人努力想要跟别人（也可能是动物或机器）分享他的知识、判断与情绪。只有当双方对一些事情达成共识，譬如彼此对一些资讯或知识都有分享，沟通才算成功。

◆ 规则五，找出重要单字，透过它们与作者达成共识。

◆ 因为语言并不是完美的传递知识的媒介，因而在沟通时也会有形成障碍的作用。

◆ 就像教学，除非被教的学生产生呼应的活力，否则光靠老师是行不通的。

◆ 文法面向是处理单字的。逻辑面向是处理这些单字的意义，或说得更精确一点，是处理词义的

◆ 泰半

◆ 如果你把觉得有困扰的字圈出来，很可能就找出了作者有特定用法的那些字了。

◆ 如果你知道这是什么种类的书，整本书在谈的主题是什么，有哪些重要的部分，将大大帮助你把专门用语从一般用语中区分出来

◆ 事实上，一本书之所以能给你带来新的洞察力或启发，就是因为其中有一些你不能一读即懂的字句。

◆ 2025/10/07发表想法

G 很好的例子，很多复杂的事情就像玩拼图一样，当你不断尝试并时不时拼成一块正确的拼图时，这个拼图游戏会变得越来越简单，因为剩下的拼图越来越少了。

原文：整个过程有点像是在玩拼图时尝试错误的方法。你所拼起来的部分越多，越容易找到还没拼的部分，原因只不过剩下的部分减少了。

◆ 2025/10/07发表想法

以后自己想表达某些观点时，也要如此，就是遣词造句要精准

原文：如果作者用字用得模糊不清，你根本就搞不清楚他说的是什么。你只会发现他并不知道自己说的是什么。


第九章 判断作者的主旨

◆ 2025/10/22发表想法

测试

原文：成功的谈判协商，除了需要诚实外，提案还要清楚，有吸引力。这样交易的双方才能够达成共识。

◆ 成功的谈判协商，除了需要诚实外，提案还要清楚，有吸引力。这样交易的双方才能够达成共识。

◆ 2025/10/16发表想法

这句话不是很好理解

原文：这样的提案，是一种知识的声明，而不是意图的声明。

◆ 2025/10/16发表想法

看一本书的时候，要建立目标，看看自己想要的或者作者要给的东西是否真的给了出来。

原文：就一部论说性的作品来说，通常他会承诺要指导我们做某件事。为了确定他有没有遵守这些承诺，我们就一定要找出他的主旨(propositions)才行。

-- 来自微信读书
"""

print(extract_metadata(text))